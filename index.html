<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ally Admin Workspace</title>
    <link rel="stylesheet" href="style.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:ital,opsz,wght@0,14..32,800;1,14..32,800&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
        integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin="">

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
        integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin="" defer></script>
</head>

<body>
    <header class="page-header">
        <div class="brand">
            <h1>Ally Admin Workspace</h1>
            <p>Manage building polygons and generate SF2 attendance reports</p>
        </div>
        <nav class="tab-bar" aria-label="Admin tools">
            <button class="tab-button is-active" data-tab-target="buildingPanel" type="button">Building Manager</button>
            <button class="tab-button" data-tab-target="sf2Panel" type="button">SF2 Daily Attendance</button>
        </nav>
    </header>

    <main class="page-content">
        <section id="buildingPanel" class="panel is-active" aria-labelledby="building-tab">
            <h2 id="building-tab">Building Manager</h2>
            <div class="container">
                <div class="form-section">
                    <form id="buildingForm">
                        <label>Name
                            <input type="text" id="name" required placeholder="Name">
                        </label>
                        <label>Color Hex
                            <input type="text" id="color" value="#6366F1" required placeholder="#6366F1">
                        </label>
                        <label>Level
                            <input type="number" id="level" value="1" min="0">
                        </label>
                        <label>GeoPoint Coords
                            <input type="text" id="pointA" placeholder="Lat,Long">
                            <input type="text" id="pointB" placeholder="Lat,Long">
                            <input type="text" id="pointC" placeholder="Lat,Long">
                            <input type="text" id="pointD" placeholder="Lat,Long">
                        </label>
                        <button type="submit">Save</button>
                    </form>
                </div>

                <div class="list-section">
                    <h3>Building List</h3>
                    <button id="refreshList">Refresh</button>
                    <ul id="buildingList"></ul>
                    <div class="map-wrapper">
                        <h4>Map View</h4>
                        <div id="buildingMap"></div>
                    </div>
                </div>
            </div>
        </section>

        <section id="sf2Panel" class="panel" aria-labelledby="sf2-tab">
            <div class="sf2-container">
                <h2 id="sf2-tab">SF2 Daily Attendance Report Generator</h2>

                <div class="controls">
                    <div class="form-row">
                        <div class="form-group">
                            <label for="teacherId">Teacher ID</label>
                            <input type="text" id="teacherId" placeholder="Enter your teacher ID" required>
                        </div>
                        <div class="form-group">
                            <label for="reportDate">Reference Date (within month)</label>
                            <input type="date" id="reportDate" required>
                        </div>
                        <div class="form-group">
                            <label for="gradeLevel">Grade/Section</label>
                            <input type="text" id="gradeLevel" placeholder="e.g., Grade 10-A">
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="schoolYear">School Year</label>
                            <input type="text" id="schoolYear" placeholder="e.g., 2024-2025" required>
                        </div>
                        <div class="form-group">
                            <label for="month">Month</label>
                            <select id="month">
                                <option value="January">January</option>
                                <option value="February">February</option>
                                <option value="March">March</option>
                                <option value="April">April</option>
                                <option value="May">May</option>
                                <option value="June">June</option>
                                <option value="July">July</option>
                                <option value="August">August</option>
                                <option value="September">September</option>
                                <option value="October">October</option>
                                <option value="November">November</option>
                                <option value="December">December</option>
                            </select>
                        </div>
                    </div>

                    <div class="btn-group">
                        <button class="btn btn-primary" id="generateReport" type="button">Generate Report</button>
                        <button class="btn btn-secondary" id="exportExcel" type="button" disabled>Export to Excel</button>
                        <button class="btn btn-secondary" id="exportCSV" type="button" disabled>Export to CSV</button>
                    </div>

                    <div class="template-upload">
                        <label for="templateFile">Upload XLSX Template</label>
                        <input type="file" id="templateFile" accept=".xlsx" />
                        <div id="templateFileName" class="file-name"></div>
                    </div>
                </div>

                <div id="reportContainer" class="report-container" hidden>
                    <div class="report-preview">
                        <h3>School Form 2 (SF2) - Daily Attendance Report</h3>
                        <div id="reportHeader" class="report-header"></div>

                        <div class="status-legend">
                            <div class="legend-item">
                                <span class="legend-box present"></span>
                                <span>Present (blank)</span>
                            </div>
                            <div class="legend-item">
                                <span class="legend-box absent"></span>
                                <span>Absent (X)</span>
                            </div>
                            <div class="legend-item">
                                <span class="legend-box excused"></span>
                                <span>Excused (E)</span>
                            </div>
                        </div>

                        <div class="summary-stats" id="summaryStats"></div>

                        <div id="reportTable"></div>
                    </div>
                </div>

                <div id="loading" class="loading" hidden>
                    <p>Loading attendance data...</p>
                </div>

                <div id="error" class="error" hidden></div>
            </div>
        </section>
    </main>

    <script type="module" src="scripts/add-polygondata.js" defer></script>
    <script type="module" src="scripts/sf2-generator.js" defer></script>
    <script type="module" src="scripts/app-shell.js" defer></script>
</body>

</html>